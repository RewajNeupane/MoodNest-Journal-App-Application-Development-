@page "/journal/{Id:int}"
@layout TestLayout

@inject IJournalService JournalService

@if (_model == null)
{
    <p class="empty-state">Journal entry not found.</p>
}
else
{
    <div class="journal-detail-page">

        <!-- HEADER -->
        <header class="detail-header">
            <h1>@(_model.Title ?? "Untitled Entry")</h1>

            <div class="meta-row">
                <span class="date-text">@_createdAtText</span>
                <span class="pill primary">@_model.PrimaryMood</span>
            </div>
        </header>

        <!-- METADATA -->
        <section class="detail-meta-card">

            <!-- MOODS -->
            <div class="meta-group">
                <span class="meta-label">Moods</span>
                <div class="meta-content">
                    <span class="pill primary">@_model.PrimaryMood</span>

                    @if (!string.IsNullOrWhiteSpace(_model.SecondaryMoods))
                    {
                        @foreach (var mood in _model.SecondaryMoods.Split(','))
                        {
                            <span class="pill">@mood.Trim()</span>
                        }
                    }
                </div>
            </div>

            <!-- CATEGORY -->
            @if (!string.IsNullOrWhiteSpace(_model.Category))
            {
                <div class="meta-group">
                    <span class="meta-label">Category</span>
                    <div class="meta-content">
                        <span class="category-pill">@_model.Category</span>
                    </div>
                </div>
            }

            <!-- TAGS -->
            @if (!string.IsNullOrWhiteSpace(_model.Tags))
            {
                <div class="meta-group">
                    <span class="meta-label">Tags</span>
                    <div class="meta-content">
                        @foreach (var tag in _model.Tags.Split(','))
                        {
                            <span class="tag">#@tag.Trim()</span>
                        }
                    </div>
                </div>
            }

            <!-- DATES -->
            <div class="meta-group">
                <span class="meta-label">Timeline</span>
                <div class="meta-content timeline-dates">
                    <span>Created: <strong>@_createdAtText</strong></span>

                    @if (_updatedAtText != null)
                    {
                        <span>Updated: <strong>@_updatedAtText</strong></span>
                    }
                </div>
            </div>

        </section>

        <!-- CONTENT -->
        <article class="journal-content-card">
            @((MarkupString)_model.ContentHtml)
        </article>

    </div>
}

@code {

    [Parameter] public int Id { get; set; }

    private JournalEntryViewModel? _model;

    private string _createdAtText = string.Empty;
    private string? _updatedAtText;

    protected override async Task OnInitializedAsync()
    {
        var result = await JournalService.GetByIdAsync(Id);

        if (!result.Success || result.Data == null)
            return;

        _model = result.Data;

        // UI formatting only
        _createdAtText = _model.CreatedAt.ToString("dddd, MMMM dd yyyy");

        // Show updated date only if it differs
        if (_model.UpdatedAt != _model.CreatedAt)
        {
            _updatedAtText = _model.UpdatedAt.ToString("dddd, MMMM dd yyyy");
        }
    }
}
