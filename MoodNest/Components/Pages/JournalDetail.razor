@page "/journal/{Id:int}"
@layout TestLayout
@using MoodNest.Components.Services

@inject IJournalService JournalService

@if (_model == null)
{
    <p class="not-found">Journal entry not found.</p>
}
else
{
    <div class="journal-detail-page">

        <header class="detail-header">
            <h1>@(_model.Title ?? "Untitled Entry")</h1>

            <div class="meta-row">
                <span class="date">@_createdAtText</span>
                <span class="pill primary">@_model.PrimaryMood</span>
            </div>
        </header>

        <section class="info-grid">

            <div class="info-block">
                <h4>Moods</h4>
                <div class="pill-group">
                    <span class="pill primary">@_model.PrimaryMood</span>

                    @if (!string.IsNullOrWhiteSpace(_model.SecondaryMoods))
                    {
                        @foreach (var mood in _model.SecondaryMoods.Split(','))
                        {
                            <span class="pill">@mood</span>
                        }
                    }
                </div>
            </div>

            <div class="info-block">
                <h4>Category</h4>
                <p>@_model.Category</p>
            </div>

            <div class="info-block">
                <h4>Tags</h4>
                <div class="tag-group">
                    @if (!string.IsNullOrWhiteSpace(_model.Tags))
                    {
                        @foreach (var tag in _model.Tags.Split(','))
                        {
                            <span class="tag">@tag</span>
                        }
                    }
                    else
                    {
                        <span class="muted">No tags</span>
                    }
                </div>
            </div>

            <div class="info-block">
                <h4>Timeline</h4>
                <p>
                    Created: <strong>@_createdAtText</strong><br />
                    Updated: <strong>@_updatedAtText</strong>
                </p>
            </div>

        </section>

        <article class="journal-content">
            @((MarkupString)_model.ContentHtml)
        </article>

    </div>
}

@code {

    [Parameter] public int Id { get; set; }

    private JournalEntryViewModel? _model;

    private string _createdAtText = string.Empty;
    private string _updatedAtText = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        var result = await JournalService.GetByIdAsync(Id);

        if (!result.Success || result.Data == null)
            return;

        _model = result.Data;

        _createdAtText = _model.CreatedAt.ToString("dddd, MMMM dd yyyy");
        _updatedAtText = _model.UpdatedAt.ToString("dddd, MMMM dd yyyy");
    }
}
