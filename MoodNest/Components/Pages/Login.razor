@page "/"
@layout TestLayout
@inject NavigationManager Nav
@inject MoodNest.Components.Services.PinAuthService Auth

<div class="lock-screen">

    <div class="lock-card">

        <span class="lock-badge">Secure Access</span>

        <h1>Unlock Your Journal</h1>

        <p class="lock-subtitle">
            Your journal is private. Enter your PIN to continue.
        </p>

        <input type="password"
               maxlength="4"
               class="pin-input"
               placeholder="● ● ● ●"
               @bind="enteredPin"
               @bind:event="oninput" />

        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <div class="error-message">
                @errorMessage
            </div>
        }

        <button class="unlock-btn" @onclick="VerifyPin">
            Unlock
        </button>

        <p class="lock-hint">
            Too many failed attempts will temporarily lock access.
        </p>

    </div>

</div>

@code {
    private string enteredPin = string.Empty;
    private string errorMessage = string.Empty;

    private async Task VerifyPin()
    {
        if (Auth.VerifyPin(enteredPin))
        {
            errorMessage = string.Empty;
            enteredPin = string.Empty;

            Auth.Unlock();
            await Task.Yield();

            Nav.NavigateTo("/test", replace: true);
        }
        else
        {
            errorMessage = "Incorrect PIN. Please try again.";
            enteredPin = string.Empty;
        }
    }
}